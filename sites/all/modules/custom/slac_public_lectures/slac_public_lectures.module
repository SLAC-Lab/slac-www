<?php

/**
 * Implements hook_form_alter()
 * @param type $form
 * @param type $form_state
 * @param type $form_id 
 */
function slac_public_lectures_form_alter(&$form, &$form_state, $form_id) {
  if ($form_id == 'block_admin_configure' && $form['delta']['#value'] == 'scheduled_lecture_block') {
    $form['settings']['next_lecture_date'] = array(
      '#type' => 'textfield',
      '#title' => t('Lecture date'),
      '#default_value' => variable_get('public_lecture_date', ''),
      '#description' => t('Input date of the next public lecture(example ' . date('F d, Y') . ').'),
    );
    $form['#submit'][] = 'slac_public_lectures_block_submit';
  }
}

function slac_public_lectures_block_submit($form, &$form_state) {
  variable_set('public_lecture_date', $form_state['values']['next_lecture_date']);
}

/**
 * Implements hook_block_info().
 */
function slac_public_lectures_block_info() {
  $blocks['scheduled_lecture_block'] = array(
    'info' => t('Scheduler Lecture'),
  );

  return $blocks;
}

/**
 * Implements hook_block_view().
 */
function slac_public_lectures_block_view($delta) {
  switch ($delta) {
    case 'scheduled_lecture_block':
      $block['subject'] = '';
      $block['content'] = slac_public_lectures_next_lecture_message(variable_get('public_lecture_date', ''));
      return $block;
      break;
  }
}

/**
 * Implements hook_ctools_plugin_directory().
 *
 * It simply tells panels where to look for the .inc file that
 * defines various args, contexts and content_types.
 */
function slac_public_lectures_ctools_plugin_directory($module, $plugin) {
  if ($module == 'ctools' && !empty($plugin)) {
    return "plugins/$plugin";
  }
}

/**
 * next lecture message
 * @param type $date
 * @return type 
 */
function slac_public_lectures_next_lecture_message($date = '') {
  $date_message = ($date) ? '<p><strong>' . t('The next is scheduled for @date', array('@date' => $date)) . '</strong></p>' : '';
  return '
    <div class="sheduled-lectures-text">Scheduled Lecture</div>
    <div class="lectures-event">
      ' . $date_message . '
      <p>We will post lecture details soon. Please check back to get specific lecture information.</p>
      <p>To receive email alerts for upcoming public lectures, please join:
      <p><a class="slac-connection-link" href="/slac-connections">&raquo;SLAC CONNECTIONS</a></p>
      and you\'ll be kept up to date on all our public lectures activity.</p>
      <p>Thank you for taking an interest in what we do at SLAC!</p>
    </div>';
}